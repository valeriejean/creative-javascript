<html>
	<head>
		<script language="javascript" type="text/javascript" src="two.js"></script>
		<script language="javascript" type="text/javascript" src="buzz.js"></script>
		<body background="wallpaper.jpg">
	</head>

	<body>
		 <script>
			var two = new Two({fullscreen: true}).appendTo(document.body);
			var pathpoint=0;
			var hour;
			var correctedHour;
			var previousCorrectedHour = -1;
			var paths = [];
			var hourPath;
			var hourObjects = [];
			var minuteObject;
			// var hourObjectsGroup = two.makeGroup();
			var timeToMove = false;
			var doorX = 200;

			var loopCounter = 0;

			// - - - - - drawings - - - - - 
			var doorHole = two.makeRectangle(200, 200, 60, 70);
			doorHole.fill = 'black';
			doorHole.noStroke();

			var door = two.makeRectangle(doorX, 200, 60, 70);
			door.fill = '#b7c8a8';
			door.stroke = '#a1ad95';
			door.linewidth = 4;

			// - - - - - actions - - - - - 
			function playToto(){
				// var toto = new buzz.sound('/Audio/toto2.wav').bind('ended', function(){
				// 	loopCounter++;
				// 	if (loopCounter < 4){
				// 		this.play();
				// 	} else {
				// 	loopCounter = 0;
				// 	}
				// }).play();
			}

			function makePaths(currentHour){
				for (var i = 0; i < currentHour; i++){
					hourPath = two.makeCurve(200, 200, 
						Math.random() * two.width, Math.random() * two.height,
						Math.random() * two.width, Math.random() * two.height,
						Math.random() * two.width, Math.random() * two.height,
						Math.random() * two.width, Math.random() * two.height,
						Math.random() * two.width, Math.random() * two.height,
						true
						);

					hourPath.stroke = 'red';
					hourPath.noFill().linewidth = .3;
					paths.push(hourPath);
					console.log(paths.length + ' number of paths');
				}
				console.log(paths.length + ' number of paths 2');				
				// makeHourObjects(correctedHour);	
			}

			function makeMinutes(currentMinutes){
				var minutePath = two.makeCurve(200, 200, 
					Math.random() * two.width, Math.random() * two.height,
					Math.random() * two.width, Math.random() * two.height,
					Math.random() * two.width, Math.random() * two.height,
					Math.random() * two.width, Math.random() * two.height,
					true
					);

				minuteObject = two.makeRectangle(0, 0, currentMinutes, currentMinutes);
				minuteObject.fill = '#FF8099';
				minuteObject.stroke = 'none';

			}

			function makeHourObjects(hours){
				console.log('making hour objects');
				playToto();
				for (var i = 0; i < hours; i++){
					var object = two.makeRectangle(0, 0, 40, 40);
					object.fill = '#FF8099';
					object.stroke = 'none';
					hourObjects.push(object);
					// hourObjectsGroup.add(object);
				}
			}

			function moveObject(){
				console.log(hourObjects.length + "number of objects");
				console.log(paths.length + ' number of paths 3');
				if (pathpoint < 1){
					for (var i = 0; i < hourObjects.length; i++){
							paths[i].getPointAt(pathpoint, hourObjects[i].translation);
							hourObjects[i].translation.addSelf(paths[i].translation);
					}
				}
			}

			function checkTime(){
				var d = new Date();
				var seconds = d.getSeconds();
				hour = d.getMinutes();

				if (hour > 12) {
					correctedHour = (hour - 12);
				} else {
					correctedHour = hour;
				}
				console.log(correctedHour + 'is the corrected hour');

				if (correctedHour !== previousCorrectedHour){
					console.log('clearing paths array');
					paths = [];
					console.log('clearing objects array');
					hourObjects = [];

					console.log('corrected hour != previousCorrectedHour');
					console.log(correctedHour + "o'clock");
					makePaths(correctedHour);
					makeHourObjects(correctedHour);	
					timeToMove = true;
					previousCorrectedHour = correctedHour;
				}
			}

			two.bind('update', function(frameCount){
				// hourObjectsGroup.translation.set(two.width/2, two.height/2);
				// hourObjectsGroup.rotation = frameCount / 120;
				checkTime();

				if (timeToMove === true){	
					door.translation.set(140, 200);
					moveObject();
					console.log('moving object now');
					
					pathpoint += .003;
					console.log(pathpoint + " is pathpoint");

					if (pathpoint >= 1){
						console.log('pathpoint is greater than 1');
						for(var i = 0; i < hourObjects.length; i++){
							hourObjects[i].translation.set(-100, -100);
						}

						door.translation.set(200, 200);
						pathpoint = 0;
						timeToMove = false;

					}
				}	

			}).play();

		</script> 
	</body>
</html>